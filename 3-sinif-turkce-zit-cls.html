<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZÄ±t AnlamlÄ± Kelimeler Ã‡alÄ±ÅŸma SayfasÄ±</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Quicksand (Genel) ve Caveat (El YazÄ±sÄ±) -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&family=Caveat:wght@400..700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS DeÄŸiÅŸkenleri (KullanÄ±cÄ±nÄ±n tercihleri entegre edildi) */
        :root {
            --page-bg: #fdfdf6; /* Defter kÃ¢ÄŸÄ±dÄ± rengi */
            --text-color: #333;
            --line-color: #cce0ff; /* AÃ§Ä±k mavi Ã§izgi rengi */
            --margin-line-color: rgba(255, 150, 150, 0.6); /* KÄ±rmÄ±zÄ± kenar Ã§izgisi */
            --accent-color: #007bff;
            --example-color: #e91e63;
            --ink-color: #0d47a1; /* Koyu mavi mÃ¼rekkep rengi */
            
            /* Fluid birimler (Mobile uyumlu) */
            --line-height: 3rem; /* SatÄ±r yÃ¼ksekliÄŸi: 48px */
            --margin-width: 4rem; /* Kenar boÅŸluÄŸu geniÅŸliÄŸi: 64px */
        }

        /* Temel Fontlar ve Arka Plan */
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #e8e8e3;
            color: var(--text-color);
        }
        .font-caveat {
            font-family: 'Caveat', cursive;
        }
        
        /* Defter Ã§izgisi arka planÄ± - Sadece yazÄ± alanÄ±na uygulanÄ±r */
        .notebook-lines {
            background-color: var(--page-bg);
            /* Ã‡izgi tekrarÄ±nÄ± ve rengini ayarla */
            background-image: repeating-linear-gradient(to bottom, 
                transparent, 
                transparent calc(var(--line-height) - 1px), 
                var(--line-color) calc(var(--line-height) - 1px), 
                var(--line-color) var(--line-height)
            );
            background-position-y: 1.5rem; /* BaÅŸlÄ±k altÄ±ndan hizala */
            background-size: 100% var(--line-height);
        }

        /* Cevap alanÄ± alt Ã§izgi efekti (KullanÄ±cÄ± girdisini vurgulamak iÃ§in) */
        .answer-space:not(.example-answer) {
            border-bottom: 1px dashed rgba(0, 0, 0, 0.2); 
            transition: border-color 0.2s;
            cursor: text;
        }
        .answer-space:focus {
            outline: none;
            border-bottom-color: var(--ink-color);
            background-color: rgba(0, 123, 255, 0.05);
            border-radius: 3px;
        }

        /* Word Item yÃ¼ksekliÄŸini satÄ±r yÃ¼ksekliÄŸine sabitle */
        .word-item {
            height: var(--line-height);
            line-height: var(--line-height);
        }
        
        /* Loading animasyonu iÃ§in CSS */
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        .animate-spin {
          animation: spin 1s linear infinite;
        }

        /* BaskÄ± (Print) AyarlarÄ± - A4 KaÄŸÄ±t DÃ¼zeni */
        @media print {
            body {
                background-color: #fff !important;
                padding: 0 !important;
            }
            .worksheet-container {
                box-shadow: none !important;
                margin: 0 !important;
                width: 210mm; /* A4 geniÅŸliÄŸi */
                min-height: 297mm; /* A4 yÃ¼ksekliÄŸi */
                /* Sol kenar boÅŸluÄŸu (margin-width) + iÃ§erik saÄŸ/Ã¼st/alt boÅŸluÄŸu */
                padding: 15mm 15mm 15mm 0 !important;
            }
            /* Grid ile ayÄ±rdÄ±ÄŸÄ±mÄ±z alanÄ± mm cinsinden sabitle */
            .worksheet-content {
                 grid-template-columns: 35mm 1fr !important; /* 35mm marj alanÄ± + iÃ§erik */
            }
            .red-line {
                 background-color: var(--margin-line-color) !important;
            }
            .print-button-container, .hole, .feedback-icon {
                display: none !important; /* Buton, delikler ve ikonlarÄ± gizle */
            }
            .answer-space {
                 border-bottom: none !important; /* BaskÄ±da alt Ã§izgiyi kaldÄ±r */
            }
            .notebook-lines {
                /* BaskÄ±da arka plan Ã§izgilerini hafiflet */
                background-color: #fff;
                background-image: repeating-linear-gradient(to bottom, 
                    transparent, 
                    transparent calc(var(--line-height) - 1px), 
                    rgba(204, 224, 255, 0.6) calc(var(--line-height) - 1px), 
                    rgba(204, 224, 255, 0.6) var(--line-height)
                );
            }
            footer {
                left: 35mm !important;
                width: calc(100% - 50mm) !important;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8">

    <!-- YazdÄ±rma Butonu ve Kontrol Butonu -->
    <div class="print-button-container w-full max-w-4xl text-center mb-6 flex justify-center space-x-4" id="printButtonContainer">
        <button onclick="window.print()"
            class="print-button bg-[var(--accent-color)] hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-xl transition duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
            <span class="mr-2">ğŸ–¨ï¸</span> YazdÄ±r / PDF Olarak Kaydet
        </button>
        <!-- Gemini API Entegrasyonu: Cevap KontrolÃ¼ -->
        <button onclick="checkAnswers()"
            class="llm-button bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-8 rounded-xl transition duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
            <span class="mr-2">âœ¨</span> CevaplarÄ± Kontrol Et
        </button>
    </div>

    <!-- Ã‡alÄ±ÅŸma SayfasÄ± Konteyneri (Mobil/Fluid + BaskÄ± iÃ§in A4) -->
    <div class="worksheet-container bg-[var(--page-bg)] max-w-4xl w-full min-h-[85vh] shadow-xl rounded-lg overflow-hidden relative flex flex-col">
        
        <!-- Ä°Ã§erik AlanÄ±: Kenar BoÅŸluÄŸu + YazÄ± AlanÄ± (Grid ile ayrÄ±ldÄ±) -->
        <div class="worksheet-content flex-grow grid grid-cols-[var(--margin-width)_1fr] relative p-4 sm:p-8 md:p-12 pb-20">

            <!-- SOL MARJ ALANI (Delikler ve KÄ±rmÄ±zÄ± Ã‡izgi) -->
            <div class="paper-margin relative h-full flex-shrink-0">
                
                <!-- KÄ±rmÄ±zÄ± Ã‡izgi -->
                <div class="red-line absolute top-0 right-0 w-[2px] h-full bg-[var(--margin-line-color)] z-10"></div>
                
                <!-- Defter Delikleri (Merkeze hizalandÄ±) -->
                <div class="hole-punches absolute inset-y-0 left-1/2 -translate-x-1/2 flex flex-col justify-evenly py-8">
                    <!-- Delik sayÄ±sÄ±nÄ± artÄ±rarak A4 formatÄ±na yaklaÅŸtÄ±rdÄ±k -->
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                    <div class="hole w-3 h-3 bg-stone-200 border border-gray-300 rounded-full shadow-inner"></div>
                </div>

            </div>

            <!-- SAÄ YAZI ALANI (BaÅŸlÄ±k ve Ã‡izgili Ä°Ã§erik) -->
            <div class="paper-writing notebook-lines h-full pt-4 md:pt-2">
                <header class="mb-6 px-1">
                    <h1 class="text-xl md:text-2xl font-bold text-gray-800 border-b-2 border-gray-200 pb-2">
                        1. AÅŸaÄŸÄ±da verilen kelimelerin zÄ±t anlamlarÄ±nÄ± Ã¶rnekteki gibi yazalÄ±m.
                    </h1>
                </header>

                <main class="h-full">
                    <div class="columns grid grid-cols-1 sm:grid-cols-2 gap-x-10 gap-y-4 px-1">
                        <!-- Bu div'ler script tarafÄ±ndan doldurulacak -->
                        <div class="column col-span-1"></div>
                        <div class="column col-span-1"></div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Alt Bilgi -->
        <footer class="w-full absolute bottom-4 left-0 right-0 flex justify-between text-sm md:text-base font-medium text-gray-500 px-12 md:px-16">
            <div class="footer-left">ilkokulakademi.com</div>
            <div class="footer-right">3. SÄ±nÄ±f TÃ¼rkÃ§e | Sayfa 1</div>
        </footer>
    </div>

    <!-- JavaScript ile Kelimeleri Dinamik Olarak OluÅŸturma ve Gemini KontrolÃ¼ -->
    <script>
        // SayfayÄ± dolduracak kelimeler listesi
        const words = [
            { word: "uzak", answer: "yakÄ±n", isExample: true },
            { word: "taze", answer: "bayat" },
            { word: "eski", answer: "yeni" },
            { word: "ince", answer: "kalÄ±n" },
            { word: "dar", answer: "geniÅŸ" },
            { word: "bÃ¼yÃ¼k", answer: "kÃ¼Ã§Ã¼k" },
            { word: "erken", answer: "geÃ§" },
            { word: "yÃ¼ksek", answer: "alÃ§ak" },
            { word: "aydÄ±nlÄ±k", answer: "karanlÄ±k" },
            { word: "gece", answer: "gÃ¼ndÃ¼z" },
            { word: "yumuÅŸak", answer: "sert" },
            { word: "ÅŸiÅŸman", answer: "zayÄ±f" },
            { word: "genÃ§", answer: "yaÅŸlÄ±" },
            { word: "kirli", answer: "temiz" },
            { word: "az", answer: "Ã§ok" },
            { word: "siyah", answer: "beyaz" },
        ];

        const columns = document.querySelectorAll('div.columns > .column');

        // Kelimeleri sÃ¼tunlara daÄŸÄ±tma
        words.forEach((item, index) => {
            const columnIndex = index % 2; // BasitÃ§e iki sÃ¼tuna daÄŸÄ±t
            const column = columns[columnIndex];
            
            const answerClass = item.isExample ? 'example-answer' : 'answer-space';
            const contentEditable = item.isExample ? '' : 'contenteditable="true"';
            
            // EÄŸer Ã¶rnekse cevabÄ± gÃ¶ster (pembe), deÄŸilse boÅŸ bÄ±rak (mavi/koyu)
            const answerContent = item.isExample ? item.answer : ''; 

            const html = `
                <div class="word-item flex items-center text-lg md:text-xl relative">
                    <span class="word font-medium w-16 text-gray-700">${item.word}</span>
                    <span class="arrow text-[var(--accent-color)] mx-2">â†’</span>
                    <span class="${answerClass} ${item.isExample ? 'text-[var(--example-color)]' : 'text-[var(--ink-color)]'} font-caveat text-3xl flex-grow px-1" 
                          ${contentEditable}>${answerContent}</span>
                </div>
            `;
            column.insertAdjacentHTML('beforeend', html);
        });

        // =========================================================================
        // GEMINI API ENTEGRASYONU: CEVAP KONTROLÃœ
        // =========================================================================

        /**
         * LLM API Ã§aÄŸrÄ±sÄ±nÄ± Ã¼stel geri Ã§ekilme (exponential backoff) ile dener.
         */
        async function retryFetch(url, payload, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return await response.json();
                    } else if (response.status === 429 && i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        throw new Error(`API Ã§aÄŸrÄ±sÄ± baÅŸarÄ±sÄ±z oldu: ${response.status}`);
                    }
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("Son API Ã§aÄŸrÄ±sÄ± denemesi baÅŸarÄ±sÄ±z oldu:", error);
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
            throw new Error("Ã‡oklu denemeden sonra API Ã§aÄŸrÄ±sÄ± baÅŸarÄ±sÄ±z oldu.");
        }

        /**
         * Ã–ÄŸrencinin cevaplarÄ±nÄ± toplar ve Gemini API'yi kullanarak doÄŸruluÄŸunu kontrol eder.
         */
        async function checkAnswers() {
            const checkButton = document.querySelector('.llm-button');
            const originalWords = document.querySelectorAll('.word');
            const answerSpaces = document.querySelectorAll('.answer-space[contenteditable="true"]');
            
            // Ã–nceki geri bildirim simgelerini temizle
            document.querySelectorAll('.feedback-icon').forEach(icon => icon.remove());
            
            // KullanÄ±cÄ± verilerini topla
            const userAnswers = [];
            let promptText = "AÅŸaÄŸÄ±daki kelime Ã§iftlerinin zÄ±t anlamlÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol et. Cevap boÅŸ bÄ±rakÄ±lmÄ±ÅŸsa veya geÃ§ersizse 'is_correct: false' olarak iÅŸaretle. CevabÄ±n doÄŸruluÄŸuna bakarken TÃ¼rkÃ§e'deki en yaygÄ±n ve kabul gÃ¶rmÃ¼ÅŸ zÄ±t anlamlÄ± kelimeyi kullan. Ã‡iftler:\n";

            answerSpaces.forEach((space, index) => {
                // index + 1 Ã§Ã¼nkÃ¼ ilk eleman Ã¶rnek (uzak â†’ yakÄ±n)
                const wordElement = originalWords[index + 1]; 
                const word = wordElement.textContent.trim();
                const userAnswer = space.textContent.trim().toLowerCase();

                userAnswers.push({ word, userAnswer, element: space });
                promptText += `\nKelime: "${word}", Ã–ÄŸrenci CevabÄ±: "${userAnswer}"`;
            });

            if (userAnswers.length === 0 || !userAnswers.some(a => a.userAnswer !== '')) {
                alert("LÃ¼tfen kontrol iÃ§in en az bir kelimenin zÄ±t anlamÄ±nÄ± yazÄ±n.");
                return;
            }

            // YÃ¼kleme durumunu ayarla
            checkButton.disabled = true;
            checkButton.innerHTML = '<span class="mr-2 animate-spin">â³</span> Kontrol Ediliyor...';

            const apiKey = ""; // Canvas ortamÄ± tarafÄ±ndan saÄŸlanÄ±r
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = "Sen, TÃ¼rkÃ§e dilbilgisi ve kelime bilgisi konusunda uzman, ilkokul seviyesine uygun geri bildirimler veren bir Ã¶ÄŸretmensin. GÃ¶revin, Ã¶ÄŸrencilerin zÄ±t anlamlÄ± kelimeler alÄ±ÅŸtÄ±rmasÄ±ndaki cevaplarÄ±nÄ± kontrol etmektir. YanÄ±tÄ±nÄ± daima verilen JSON ÅŸemasÄ±na uygun olarak, sadece JSON olarak dÃ¶ndÃ¼rmelisin. Geri bildirim (feedback_tr) kÄ±sa, teÅŸvik edici ve doÄŸru kelimeyi belirten nitelikte olmalÄ±dÄ±r.";

            const payload = {
                contents: [{ parts: [{ text: promptText }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "word": { "type": "STRING" },
                                "user_answer": { "type": "STRING" },
                                "is_correct": { "type": "BOOLEAN" },
                                "correct_answer": { "type": "STRING" },
                                "feedback_tr": { "type": "STRING" }
                            },
                            "propertyOrdering": ["word", "user_answer", "is_correct", "correct_answer", "feedback_tr"]
                        }
                    }
                }
            };
            
            try {
                const result = await retryFetch(apiUrl, payload);
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!jsonText) {
                    throw new Error("API'den geÃ§erli JSON yanÄ±tÄ± alÄ±namadÄ±.");
                }

                const feedbackArray = JSON.parse(jsonText);

                // Geri bildirimi iÅŸle ve gÃ¶ster
                let correctCount = 0;
                const totalCount = feedbackArray.length;

                userAnswers.forEach((item) => {
                    const feedback = feedbackArray.find(f => f.word === item.word);
                    const parent = item.element.closest('.word-item');

                    if (feedback) {
                        const icon = document.createElement('span');
                        // absolute -right-12: word-item'a gÃ¶re saÄŸa 3rem (48px) dÄ±ÅŸarÄ±ya konumlandÄ±rÄ±r.
                        icon.classList.add('feedback-icon', 'ml-2', 'text-2xl', 'absolute', '-right-12', 'top-1/2', '-translate-y-1/2', 'cursor-pointer');
                        
                        if (feedback.is_correct) {
                            icon.textContent = 'âœ…';
                            correctCount++;
                            parent.classList.add('transition', 'bg-green-50/50', 'rounded');
                            setTimeout(() => parent.classList.remove('bg-green-50/50'), 2000);
                        } else {
                            icon.textContent = 'âŒ';
                            parent.classList.add('transition', 'bg-red-50/50', 'rounded');
                            setTimeout(() => parent.classList.remove('bg-red-50/50'), 2000);
                        }

                        // DetaylÄ± geri bildirim iÃ§in title/tooltip ekle
                        icon.setAttribute('title', feedback.feedback_tr);
                        parent.appendChild(icon);
                    }
                });

                // Tamamlanma mesajÄ±nÄ± gÃ¶ster
                alert(`Kontrol tamamlandÄ±! ${totalCount} sorudan ${correctCount} tanesi doÄŸru. YanlÄ±ÅŸ cevaplar (âŒ) iÃ§in simgenin Ã¼zerine gelerek geri bildirimi okuyabilirsiniz.`);

            } catch (error) {
                console.error("CevaplarÄ± kontrol ederken bir hata oluÅŸtu:", error);
                alert("CevaplarÄ± kontrol etme sÄ±rasÄ±nda bir hata oluÅŸtu. Konsolu kontrol edin.");
            } finally {
                // YÃ¼kleme durumunu sÄ±fÄ±rla
                checkButton.disabled = false;
                checkButton.innerHTML = '<span class="mr-2">âœ¨</span> CevaplarÄ± Kontrol Et';
            }
        }
    </script>
</body>
</html>
